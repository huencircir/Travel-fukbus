<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FUK x BUS Trip</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        beach: {
                            blue: '#4FB0C6',
                            deepBlue: '#2C7A8E',
                            sand: '#F7F3E8',
                            yellow: '#E6C229',
                            text: '#4A4A4A'
                        }
                    },
                    fontFamily: {
                        sans: ['Noto Sans TC', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #F7F3E8; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .app-container { max-width: 480px; margin: 0 auto; background-color: #FAFAFA; min-height: 100vh; position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        
        /* ç»ç’ƒæ“¬æ…‹æ•ˆæœ Glassmorphism */
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        .glass-btn {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.2s;
        }
        .glass-btn:active {
            transform: scale(0.98);
            background: rgba(255, 255, 255, 0.8);
        }
    </style>
</head>
<body>

<div id="app" class="app-container flex flex-col font-sans text-beach-text pb-20">

    <header class="bg-gradient-to-b from-beach-blue to-beach-deepBlue text-white p-4 sticky top-0 z-50 shadow-lg rounded-b-3xl">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold tracking-wider">FUK x BUS <span class="text-xs font-light opacity-80">trip</span></h1>
                <p class="text-xs opacity-90">ç¦å²¡ x é‡œå±± 2026</p>
            </div>
            <div class="text-right glass-panel !bg-white/20 !border-white/10 p-2 rounded-xl text-white">
                <p class="text-[10px] uppercase opacity-80">å³æ™‚åŒ¯ç‡ (HKD)</p>
                <div class="text-xs font-mono font-bold">
                    JPY: {{ rates.JPY }} <br>
                    KRW: {{ rates.KRW }}
                </div>
            </div>
        </div>
    </header>

    <main class="flex-1 overflow-y-auto p-4 hide-scrollbar">
        
        <div v-if="currentTab === 'itinerary'" class="space-y-4">
            <div class="flex justify-between items-center mb-2">
                <h2 class="text-2xl font-bold text-beach-deepBlue">ğŸ—“ï¸ è¡Œç¨‹å®‰æ’</h2>
                <button v-if="viewingDay !== null" @click="viewingDay = null" class="text-xs bg-gray-200 px-3 py-1 rounded-full">è¿”å›åˆ—è¡¨</button>
            </div>
            
            <div v-if="viewingDay === null" class="grid grid-cols-2 gap-3">
                <button @click="viewingDay = 'prep'" class="col-span-2 glass-btn p-4 rounded-2xl flex items-center justify-center gap-3 text-beach-deepBlue font-bold">
                    <span class="material-icons">backpack</span> è¡Œå‰æº–å‚™
                </button>

                <button v-for="(day, index) in data.days" :key="index" 
                    @click="viewingDay = index"
                    class="glass-btn p-4 rounded-2xl flex flex-col items-center justify-center min-h-[100px] relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-1 bg-beach-yellow" v-if="[0,4,8].includes(index)"></div> <span class="text-xs text-gray-500 font-medium">Jan {{ day.date }}</span>
                    <span class="text-lg font-bold text-beach-deepBlue">DAY {{ index + 1 }}</span>
                    <span class="text-[10px] text-gray-400 mt-1">{{ day.location }}</span>
                </button>
            </div>

            <div v-else class="animate-fade-in">
                <div v-if="viewingDay === 'prep'" class="glass-panel bg-white p-5 rounded-3xl">
                    <h3 class="font-bold text-xl mb-4 text-beach-deepBlue flex items-center"><span class="material-icons mr-2">checklist</span> è¡Œå‰æº–å‚™</h3>
                    <div class="space-y-3">
                        <div v-for="(item, index) in data.prepList" :key="index" class="flex items-center gap-3 group">
                            <input type="checkbox" v-model="item.done" class="w-5 h-5 accent-beach-blue rounded">
                            <span :class="{'line-through text-gray-400': item.done}" class="flex-1 cursor-pointer" @click="editItem('prep', index)">{{ item.text }}</span>
                            <button @click="deleteItem('prep', index)" class="text-gray-300 hover:text-red-400"><span class="material-icons text-sm">delete</span></button>
                        </div>
                    </div>
                    <div class="mt-4 pt-3 border-t flex gap-2">
                        <input v-model="newItemInput.prep" @keyup.enter="addItem('prep')" placeholder="æ–°å¢é …ç›®..." class="flex-1 bg-transparent border-b border-gray-300 focus:outline-none text-sm p-1">
                        <button @click="addItem('prep')" class="text-beach-blue font-bold text-xl">+</button>
                    </div>
                </div>

                <div v-else class="space-y-4">
                    <div class="glass-panel bg-white p-4 rounded-3xl relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-24 bg-gradient-to-r from-blue-100 to-yellow-50 -z-10 opacity-50"></div>
                        <div class="flex justify-between items-end mb-4">
                            <div>
                                <h3 class="text-2xl font-bold text-beach-deepBlue">DAY {{ viewingDay + 1 }}</h3>
                                <p class="text-sm text-gray-500">2026/1/{{ data.days[viewingDay].date }} Â· {{ data.days[viewingDay].location }}</p>
                            </div>
                            <div class="text-right">
                                <span class="material-icons text-beach-yellow text-3xl">wb_sunny</span>
                                <p class="text-xs font-bold text-gray-600">é å ±: æ™´</p>
                            </div>
                        </div>

                        <div class="space-y-4 relative">
                            <div class="absolute left-[19px] top-2 bottom-2 w-0.5 bg-gray-200"></div>
                            
                            <div v-for="(event, eIdx) in data.days[viewingDay].events" :key="eIdx" class="relative flex gap-4 group">
                                <div class="w-10 h-10 rounded-full bg-white border-2 border-beach-blue flex items-center justify-center shrink-0 z-10 shadow-sm text-xs font-bold text-beach-blue">
                                    {{ event.time }}
                                </div>
                                <div class="flex-1 glass-btn bg-white/60 p-3 rounded-xl flex justify-between items-start">
                                    <div @click="editItem('event', viewingDay, eIdx)" class="cursor-pointer">
                                        <h4 class="font-bold text-gray-800">{{ event.title }}</h4>
                                        <p class="text-xs text-gray-500 flex items-center gap-1 mt-1">
                                            <span class="material-icons text-[12px]">place</span> {{ event.address }}
                                        </p>
                                    </div>
                                    <div class="flex flex-col gap-2">
                                        <a :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(event.address)" target="_blank" class="text-beach-blue">
                                            <span class="material-icons text-sm">navigation</span>
                                        </a>
                                        <button @click="deleteItem('event', viewingDay, eIdx)" class="text-gray-300 hover:text-red-400">
                                            <span class="material-icons text-sm">close</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="glass-panel bg-white p-4 rounded-3xl">
                        <h4 class="font-bold text-sm mb-2 text-gray-600">æ–°å¢è¡Œç¨‹</h4>
                        <div class="grid grid-cols-3 gap-2 mb-2">
                            <input v-model="newItemInput.time" type="time" class="p-2 bg-gray-50 rounded-lg text-xs border">
                            <input v-model="newItemInput.title" placeholder="æ¨™é¡Œ" class="col-span-2 p-2 bg-gray-50 rounded-lg text-xs border">
                        </div>
                        <input v-model="newItemInput.address" placeholder="åœ°å€ / åœ°é»" class="w-full p-2 bg-gray-50 rounded-lg text-xs border mb-2">
                        <button @click="addItem('event')" class="w-full bg-beach-deepBlue text-white py-2 rounded-xl shadow-md text-sm">åŠ å…¥è¡Œç¨‹</button>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'map'" class="space-y-4 h-full flex flex-col">
            <h2 class="text-2xl font-bold text-beach-deepBlue">ğŸ—ºï¸ åœ°åœ–</h2>
            
            <div class="w-full h-64 rounded-3xl overflow-hidden shadow-lg border-2 border-white">
                <iframe 
                    width="100%" 
                    height="100%" 
                    style="border:0" 
                    loading="lazy" 
                    allowfullscreen
                    :src="mapEmbedSrc">
                </iframe>
            </div>

            <div class="flex-1 overflow-y-auto space-y-2 pb-10">
                <p class="text-xs text-gray-400 ml-1">é»æ“Šåœ°é»ä»¥æ›´æ–°ä¸Šæ–¹åœ°åœ–</p>
                <div v-for="(pin, index) in mapPins" :key="index" 
                     @click="updateMap(pin.address)"
                     class="glass-btn bg-white p-3 rounded-xl flex justify-between items-center cursor-pointer hover:bg-white">
                    <div class="flex items-center gap-3">
                        <span class="material-icons text-red-500">location_on</span>
                        <div>
                            <div class="font-bold text-sm">{{ pin.name }}</div>
                            <div class="text-xs text-gray-500 truncate w-48">{{ pin.address }}</div>
                        </div>
                    </div>
                    <button @click.stop="deleteItem('pin', index)" class="text-gray-300 hover:text-red-400"><span class="material-icons text-sm">delete</span></button>
                </div>

                <div class="mt-4 p-3 bg-white/50 rounded-xl border border-dashed border-gray-300">
                    <div class="flex gap-2 mb-2">
                        <input v-model="newItemInput.pinName" placeholder="åœ°é»åç¨±" class="w-1/3 p-2 text-xs rounded border">
                        <input v-model="newItemInput.pinAddr" placeholder="è©³ç´°åœ°å€" class="w-2/3 p-2 text-xs rounded border">
                    </div>
                    <button @click="addItem('pin')" class="w-full bg-gray-200 text-gray-600 text-xs py-2 rounded">+ æ–°å¢ Pin</button>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'accounting'" class="space-y-4">
            <h2 class="text-2xl font-bold text-beach-deepBlue">ğŸ’° è¨˜å¸³</h2>
            
            <div class="glass-panel bg-white p-4 rounded-3xl flex flex-col items-center shadow-sm">
                <div class="w-48 h-48 relative">
                    <canvas id="expenseChart"></canvas>
                </div>
                <div class="mt-4 text-center">
                    <p class="text-xs text-gray-400">ç¸½æ”¯å‡º (HKD)</p>
                    <p class="text-3xl font-black text-beach-deepBlue">${{ totalExpenseHKD }}</p>
                </div>
            </div>

            <div class="glass-panel bg-white p-4 rounded-3xl shadow-sm space-y-3">
                <h3 class="font-bold text-sm text-gray-600">è¨˜ä¸€ç­†</h3>
                <div class="grid grid-cols-3 gap-2">
                    <input v-model.number="newExpense.amount" type="number" placeholder="é‡‘é¡" class="col-span-2 p-2 border rounded-lg bg-gray-50 text-sm">
                    <select v-model="newExpense.currency" class="p-2 border rounded-lg bg-gray-50 text-sm">
                        <option value="HKD">HKD</option>
                        <option value="JPY">JPY</option>
                        <option value="KRW">KRW</option>
                    </select>
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <select v-model="newExpense.type" class="p-2 border rounded-lg bg-gray-50 text-sm">
                        <option value="é£Ÿ">ğŸ” é£Ÿ</option>
                        <option value="äº¤é€š">ğŸš‡ äº¤é€š</option>
                        <option value="è³¼ç‰©">ğŸ›ï¸ è³¼ç‰©</option>
                        <option value="ä½å®¿">ğŸ¨ ä½å®¿</option>
                        <option value="å…¶ä»–">ğŸ“„ å…¶ä»–</option>
                    </select>
                    <select v-model="newExpense.method" class="p-2 border rounded-lg bg-gray-50 text-sm">
                        <option value="Cash">ç¾é‡‘</option>
                        <option value="Card">ä¿¡ç”¨å¡</option>
                    </select>
                </div>
                <div class="flex gap-2">
                    <input v-model="newExpense.note" placeholder="å‚™è¨» (å¦‚: æ™šé¤)" class="flex-1 p-2 border rounded-lg bg-gray-50 text-sm">
                    <button @click="addExpense" class="bg-beach-yellow text-white px-4 rounded-lg shadow font-bold">OK</button>
                </div>
            </div>

            <div class="space-y-2 pb-20">
                <div v-for="(ex, index) in expenses" :key="index" class="bg-white p-3 rounded-xl flex justify-between items-center shadow-sm border-l-4" :class="getExpenseColor(ex.type)">
                    <div class="flex-1" @click="editItem('expense', index)">
                        <div class="font-bold text-gray-700 text-sm">{{ ex.note || ex.type }}</div>
                        <div class="text-xs text-gray-400">{{ ex.type }} Â· {{ ex.method }}</div>
                    </div>
                    <div class="text-right mr-3">
                        <div class="font-bold text-gray-800">{{ ex.amount }} <span class="text-[10px]">{{ ex.currency }}</span></div>
                    </div>
                    <button @click="deleteItem('expense', index)" class="text-gray-300 hover:text-red-400"><span class="material-icons text-sm">close</span></button>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'shopping'" class="space-y-4">
            <h2 class="text-2xl font-bold text-beach-deepBlue">ğŸ›ï¸ æ¸…å–®</h2>
            
            <div class="flex gap-2 p-1 bg-gray-200 rounded-xl">
                <button @click="shopFilter='all'" :class="shopFilter=='all' ? 'bg-white shadow text-beach-blue' : 'text-gray-500'" class="flex-1 py-1 rounded-lg text-sm transition-all">å…¨éƒ¨</button>
                <button @click="shopFilter='food'" :class="shopFilter=='food' ? 'bg-white shadow text-beach-blue' : 'text-gray-500'" class="flex-1 py-1 rounded-lg text-sm transition-all">ç¾é£Ÿ</button>
                <button @click="shopFilter='shop'" :class="shopFilter=='shop' ? 'bg-white shadow text-beach-blue' : 'text-gray-500'" class="flex-1 py-1 rounded-lg text-sm transition-all">è³¼ç‰©</button>
            </div>

            <div class="glass-panel bg-white p-3 rounded-2xl flex flex-col gap-2">
                <div class="flex gap-2">
                    <input v-model="newItemInput.shopName" placeholder="åç¨±" class="flex-1 p-2 text-xs border rounded">
                    <input v-model="newItemInput.shopPrice" placeholder="é ç®—" class="w-16 p-2 text-xs border rounded">
                </div>
                <div class="flex gap-2">
                    <select v-model="newItemInput.shopCat" class="text-xs border rounded p-1">
                        <option value="food">ç¾é£Ÿ</option>
                        <option value="shop">è³¼ç‰©</option>
                    </select>
                    <input v-model="newItemInput.shopUrl" placeholder="ç¶²å€ (é¸å¡«)" class="flex-1 p-2 text-xs border rounded">
                    <button @click="addItem('shop')" class="bg-beach-deepBlue text-white px-3 rounded text-xs">æ–°å¢</button>
                </div>
            </div>

            <div class="grid grid-cols-1 gap-3">
                <div v-for="(item, index) in filteredShopList" :key="index" class="glass-panel bg-white rounded-xl p-3 flex items-center gap-3 shadow-sm">
                    <button @click="toggleShopDone(item)" class="w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors" :class="item.done ? 'bg-green-500 border-green-500 text-white' : 'border-gray-300 text-transparent'">
                        <span class="material-icons text-sm">check</span>
                    </button>
                    
                    <div class="flex-1 overflow-hidden" @click="editItem('shop', index)"> <div class="flex items-center gap-2">
                            <span class="text-[10px] px-1.5 py-0.5 rounded bg-gray-100 text-gray-500">{{ item.category === 'food' ? 'ç¾é£Ÿ' : 'è³¼ç‰©' }}</span>
                            <h4 class="font-bold text-sm truncate" :class="{'line-through text-gray-400': item.done}">{{ item.name }}</h4>
                        </div>
                        <p class="text-xs text-beach-yellow font-bold mt-1">{{ item.price }}</p>
                        <a v-if="item.url" :href="item.url" target="_blank" class="text-[10px] text-blue-400 flex items-center mt-1">
                            <span class="material-icons text-[10px] mr-1">link</span>é€£çµ
                        </a>
                    </div>
                    
                    <button @click="deleteShopItem(item)" class="text-gray-300 hover:text-red-400 px-2"><span class="material-icons text-sm">delete</span></button>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'info'" class="space-y-6">
            <h2 class="text-2xl font-bold text-beach-deepBlue">â„¹ï¸ é…’åº—èˆ‡äº¤é€š</h2>
            
            <div class="glass-panel bg-white p-5 rounded-3xl shadow-sm border-l-4 border-beach-blue">
                <h3 class="font-bold text-lg mb-2 text-beach-deepBlue">ğŸ¨ ç¦å²¡ä½å®¿ (4æ™š)</h3>
                <p class="font-bold text-gray-800">ç¦å²¡å¤©ç¥é‡Œå£«æ»¿é…’åº—</p>
                <p class="text-xs text-gray-500 mb-2">Richmond Hotel Fukuoka Tenjin</p>
                
                <div class="text-sm space-y-1 text-gray-600 mb-3 bg-gray-50 p-2 rounded-lg">
                    <p>ğŸ“ åœ°å€ï¼šç¦å²¡å¸‚ä¸­å¤®å€æ¸¡é‚Šé€š4-8-25</p>
                    <p>ğŸ“ é›»è©±ï¼š+81 92-739-2055</p>
                </div>

                <div class="flex justify-between text-xs font-bold text-beach-blue">
                    <div class="text-center bg-blue-50 p-2 rounded flex-1 mr-2">
                        <span class="block text-gray-400 font-normal">Check-in</span>
                        14:00 (1/4)
                    </div>
                    <div class="text-center bg-blue-50 p-2 rounded flex-1">
                        <span class="block text-gray-400 font-normal">Check-out</span>
                        11:00 (1/8)
                    </div>
                </div>
                
                <a href="https://www.google.com/maps/search/?api=1&query=Richmond+Hotel+Fukuoka+Tenjin" target="_blank" class="block w-full text-center mt-3 py-2 bg-beach-blue text-white rounded-lg text-sm shadow">é–‹å•Ÿåœ°åœ–</a>
            </div>

            <div class="glass-panel bg-white p-5 rounded-3xl shadow-sm border-l-4 border-beach-yellow">
                <h3 class="font-bold text-lg mb-2 text-yellow-600">ğŸ¨ é‡œå±±ä½å®¿ (4æ™š)</h3>
                <p class="font-bold text-gray-800">Felix by STX Hotel & Suite</p>
                
                <div class="text-sm space-y-1 text-gray-600 mb-3 bg-gray-50 p-2 rounded-lg">
                    <p>ğŸ“ åœ°å€ï¼šé‡œå±±æµ·é›²å°å€æµ·é›²å°è·¯ 620</p>
                    <p>ğŸ“ é›»è©±ï¼š+82 51-969-5000</p>
                </div>

                <div class="flex justify-between text-xs font-bold text-yellow-600">
                    <div class="text-center bg-yellow-50 p-2 rounded flex-1 mr-2">
                        <span class="block text-gray-400 font-normal">Check-in</span>
                        15:00 (1/8)
                    </div>
                    <div class="text-center bg-yellow-50 p-2 rounded flex-1">
                        <span class="block text-gray-400 font-normal">Check-out</span>
                        11:00 (1/12)
                    </div>
                </div>
                <a href="https://www.google.com/maps/search/?api=1&query=Felix+by+STX+Hotel+and+Suite" target="_blank" class="block w-full text-center mt-3 py-2 bg-yellow-500 text-white rounded-lg text-sm shadow">é–‹å•Ÿåœ°åœ–</a>
            </div>
        </div>

    </main>

    <nav class="glass-panel fixed bottom-0 left-0 right-0 max-w-[480px] mx-auto bg-white/90 border-t border-gray-200 flex justify-around items-center py-2 pb-safe z-50 text-xs shadow-[0_-5px_20px_rgba(0,0,0,0.05)] backdrop-blur-lg">
        <button v-for="tab in tabs" :key="tab.id" @click="currentTab = tab.id" 
                class="flex flex-col items-center w-1/5 transition-colors duration-300"
                :class="currentTab === tab.id ? 'text-beach-deepBlue scale-110' : 'text-gray-400'">
            <span class="material-icons mb-0.5">{{ tab.icon }}</span>
            <span class="scale-90">{{ tab.label }}</span>
        </button>
    </nav>

</div>

<script>
    const { createApp, ref, computed, onMounted, watch, nextTick } = Vue;

    createApp({
        setup() {
            const currentTab = ref('itinerary');
            const viewingDay = ref(null); // null = grid view, number = specific day, 'prep' = prep list
            const tabs = [
                { id: 'itinerary', label: 'è¡Œç¨‹', icon: 'calendar_month' },
                { id: 'map', label: 'åœ°åœ–', icon: 'map' },
                { id: 'accounting', label: 'è¨˜å¸³', icon: 'pie_chart' },
                { id: 'shopping', label: 'æ¸…å–®', icon: 'shopping_bag' },
                { id: 'info', label: 'è³‡è¨Š', icon: 'info' }
            ];

            // åŒ¯ç‡ (æ¨¡æ“¬)
            const rates = ref({ JPY: '0.052', KRW: '0.0058' });

            // è¼¸å…¥ç·©å­˜
            const newItemInput = ref({
                prep: '', time: '', title: '', address: '',
                pinName: '', pinAddr: '',
                shopName: '', shopPrice: '', shopCat: 'food', shopUrl: ''
            });

            // 1. è¡Œç¨‹æ•¸æ“š (é å¡«èˆªç­)
            const data = ref({
                prepList: [
                    { text: 'ç¢ºèªè­·ç…§æ•ˆæœŸ', done: true },
                    { text: 'è³¼è²·æ—…éŠä¿éšª', done: false },
                    { text: 'é–‹é€šæ¼«éŠ/Simå¡', done: false }
                ],
                days: [
                    { date: '4', location: 'é¦™æ¸¯ â†’ ç¦å²¡', events: [
                        { time: 'TBA', title: 'âœˆï¸ UO600 é¦™æ¸¯ -> ç¦å²¡', address: 'ç¦å²¡æ©Ÿå ´ (FUK)' },
                        { time: '14:00', title: 'ğŸ¨ Check-in ç¦å²¡é…’åº—', address: 'ç¦å²¡å¤©ç¥é‡Œå£«æ»¿é…’åº—' }
                    ]},
                    { date: '5', location: 'ç¦å²¡', events: [] },
                    { date: '6', location: 'ç¦å²¡', events: [] },
                    { date: '7', location: 'ç¦å²¡', events: [] },
                    { date: '8', location: 'ç¦å²¡ â†’ é‡œå±±', events: [
                        { time: '09:25', title: 'âœˆï¸ BX 147 ç¦å²¡ -> é‡œå±±', address: 'é‡œå±±é‡‘æµ·æ©Ÿå ´ (PUS)' },
                        { time: '10:25', title: 'æŠµé”é‡œå±±', address: 'é‡‘æµ·åœ‹éš›æ©Ÿå ´' },
                        { time: '15:00', title: 'ğŸ¨ Check-in é‡œå±±é…’åº—', address: 'Felix by STX Hotel' }
                    ]},
                    { date: '9', location: 'é‡œå±±', events: [] },
                    { date: '10', location: 'é‡œå±±', events: [] },
                    { date: '11', location: 'é‡œå±±', events: [] },
                    { date: '12', location: 'é‡œå±± â†’ é¦™æ¸¯', events: [
                        { time: '11:00', title: 'ğŸ¨ Check-out', address: 'Felix by STX Hotel' },
                        { time: 'TBA', title: 'âœˆï¸ UO675 é‡œå±± -> é¦™æ¸¯', address: 'é‡‘æµ·åœ‹éš›æ©Ÿå ´' }
                    ]}
                ]
            });

            // 2. åœ°åœ– Pins
            const mapPins = ref([
                { name: 'ç¦å²¡å¤©ç¥é‡Œå£«æ»¿é…’åº—', address: 'Richmond Hotel Fukuoka Tenjin' },
                { name: 'é‡œå±± Felix by STX', address: 'Felix by STX Hotel and Suite' },
                { name: 'ç¦å²¡å¡”', address: 'Fukuoka Tower' }
            ]);
            const mapEmbedSrc = ref('https://maps.google.com/maps?q=Fukuoka&t=&z=13&ie=UTF8&iwloc=&output=embed');

            const updateMap = (address) => {
                mapEmbedSrc.value = `https://maps.google.com/maps?q=${encodeURIComponent(address)}&t=&z=15&ie=UTF8&iwloc=&output=embed`;
            };

            // 3. è¨˜å¸³
            const newExpense = ref({ amount: null, currency: 'HKD', type: 'é£Ÿ', method: 'Cash', note: '' });
            const expenses = ref([
                { amount: 3000, currency: 'HKD', type: 'äº¤é€š', method: 'Card', note: 'æ©Ÿç¥¨ (UO)' },
                { amount: 1000, currency: 'JPY', type: 'é£Ÿ', method: 'Cash', note: 'æ‹‰éºµ' }
            ]);

            const getExpenseColor = (type) => {
                const map = { 'é£Ÿ': 'border-orange-400', 'äº¤é€š': 'border-blue-400', 'è³¼ç‰©': 'border-pink-400', 'ä½å®¿': 'border-purple-400', 'å…¶ä»–': 'border-gray-400' };
                return map[type] || 'border-gray-400';
            };

            const totalExpenseHKD = computed(() => {
                return expenses.value.reduce((total, item) => {
                    let rate = 1;
                    if(item.currency === 'JPY') rate = parseFloat(rates.value.JPY);
                    if(item.currency === 'KRW') rate = parseFloat(rates.value.KRW);
                    return total + (item.amount * rate);
                }, 0).toFixed(0);
            });

            // Chart Logic
            let chartInstance = null;
            const renderChart = () => {
                const ctx = document.getElementById('expenseChart');
                if(!ctx) return;
                
                // Group data
                const groups = {};
                expenses.value.forEach(ex => {
                    let rate = 1;
                    if(ex.currency === 'JPY') rate = parseFloat(rates.value.JPY);
                    if(ex.currency === 'KRW') rate = parseFloat(rates.value.KRW);
                    const val = ex.amount * rate;
                    groups[ex.type] = (groups[ex.type] || 0) + val;
                });

                const labels = Object.keys(groups);
                const dataVals = Object.values(groups);
                const bgColors = ['#FDBA74', '#60A5FA', '#F472B6', '#C084FC', '#9CA3AF'];

                if(chartInstance) chartInstance.destroy();

                chartInstance = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: dataVals,
                            backgroundColor: bgColors,
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'bottom', labels: { boxWidth: 10, font: {size: 10} } } }
                    }
                });
            };

            // Watch tab change to render chart
            watch(currentTab, async (newVal) => {
                if(newVal === 'accounting') {
                    await nextTick();
                    renderChart();
                }
            });

            // 4. è³¼ç‰©æ¸…å–®
            const shopFilter = ref('all');
            const shoppingList = ref([
                { name: 'åšå¤šæ˜å¤ªå­', price: 'Â¥1500', category: 'food', done: false },
                { name: 'Olive Young é¢è†œ', price: 'â‚©30000', category: 'shop', done: false }
            ]);
            
            const filteredShopList = computed(() => {
                if(shopFilter.value === 'all') return shoppingList.value;
                return shoppingList.value.filter(i => i.category === shopFilter.value);
            });

            // é€šç”¨: æ–°å¢é …ç›®
            const addItem = (type) => {
                if(type === 'prep' && newItemInput.value.prep) {
                    data.value.prepList.push({ text: newItemInput.value.prep, done: false });
                    newItemInput.value.prep = '';
                } else if (type === 'event') {
                    if(newItemInput.value.title) {
                        data.value.days[viewingDay.value].events.push({
                            time: newItemInput.value.time || 'TBA',
                            title: newItemInput.value.title,
                            address: newItemInput.value.address
                        });
                        // sort by time
                        data.value.days[viewingDay.value].events.sort((a,b) => a.time.localeCompare(b.time));
                        newItemInput.value.title = ''; newItemInput.value.address = ''; newItemInput.value.time = '';
                    }
                } else if (type === 'pin' && newItemInput.value.pinName) {
                    mapPins.value.push({ name: newItemInput.value.pinName, address: newItemInput.value.pinAddr });
                    updateMap(newItemInput.value.pinAddr);
                    newItemInput.value.pinName = ''; newItemInput.value.pinAddr = '';
                } else if (type === 'shop' && newItemInput.value.shopName) {
                    shoppingList.value.push({
                        name: newItemInput.value.shopName,
                        price: newItemInput.value.shopPrice,
                        category: newItemInput.value.shopCat,
                        url: newItemInput.value.shopUrl,
                        done: false
                    });
                    newItemInput.value.shopName = ''; newItemInput.value.shopPrice = '';
                }
            };

            const addExpense = () => {
                if(newExpense.value.amount) {
                    expenses.value.push({ ...newExpense.value });
                    newExpense.value.amount = null; newExpense.value.note = '';
                    renderChart();
                }
            };

            // é€šç”¨: åˆªé™¤åŠŸèƒ½
            const deleteItem = (type, idx, subIdx = null) => {
                if(!confirm('ç¢ºå®šåˆªé™¤å—ï¼Ÿ')) return;
                
                if(type === 'prep') data.value.prepList.splice(idx, 1);
                if(type === 'event') data.value.days[idx].events.splice(subIdx, 1);
                if(type === 'pin') mapPins.value.splice(idx, 1);
                if(type === 'expense') { expenses.value.splice(idx, 1); renderChart(); }
            };

            const deleteShopItem = (item) => {
                if(!confirm('ç¢ºå®šåˆªé™¤å—ï¼Ÿ')) return;
                const i = shoppingList.value.indexOf(item);
                if(i > -1) shoppingList.value.splice(i, 1);
            };

            // é€šç”¨: ç·¨è¼¯åŠŸèƒ½ (ä½¿ç”¨ç°¡å–®çš„ Prompt)
            const editItem = (type, idx, subIdx = null) => {
                let newVal, newNote, newAmt;
                
                if(type === 'prep') {
                    newVal = prompt("ä¿®æ”¹é …ç›®:", data.value.prepList[idx].text);
                    if(newVal) data.value.prepList[idx].text = newVal;
                }
                if(type === 'event') {
                    const ev = data.value.days[idx].events[subIdx];
                    newVal = prompt("ä¿®æ”¹æ¨™é¡Œ:", ev.title);
                    if(newVal) ev.title = newVal;
                    const newAddr = prompt("ä¿®æ”¹åœ°å€:", ev.address);
                    if(newAddr) ev.address = newAddr;
                }
                if(type === 'expense') {
                    newNote = prompt("ä¿®æ”¹å‚™è¨»:", expenses.value[idx].note);
                    if(newNote) expenses.value[idx].note = newNote;
                    newAmt = prompt("ä¿®æ”¹é‡‘é¡:", expenses.value[idx].amount);
                    if(newAmt) { expenses.value[idx].amount = parseFloat(newAmt); renderChart(); }
                }
                if(type === 'shop') {
                    // å°æ–¼éæ¿¾æ¸…å–®ï¼Œé€™è£¡ç”¨æœ€ç°¡å–®çš„æ–¹å¼ï¼š
                    // åœ¨çœŸå¯¦ App æœƒç”¨ Modalï¼Œé€™è£¡ç°¡åŒ–ç‚º Prompt
                    // é€™è£¡çš„ index æ˜¯åœ¨éæ¿¾åˆ—è¡¨ä¸­çš„ï¼Œéœ€è¦æ³¨æ„ç›´æ¥ä¿®æ”¹ç‰©ä»¶å¼•ç”¨å³å¯
                    // ä½†å› ç‚ºåœ¨ template å‚³éçš„æ˜¯ item (ä¸æ˜¯ index)ï¼Œæˆ‘å€‘éœ€è¦å¾ filtered list å‚³é item
                    // ä½† template ä¸Šé¢å¯«çš„æ˜¯ click="editItem('shop', index)"ï¼Œé€™æŒ‡å‘ filteredShopList çš„ index
                    // æœ€ç°¡å–®çš„æ–¹å¼æ˜¯æ”¹ç‚ºå‚³é item å°è±¡
                    const item = filteredShopList.value[idx];
                    newVal = prompt("ä¿®æ”¹åç¨±:", item.name);
                    if(newVal) item.name = newVal;
                    const newPrice = prompt("ä¿®æ”¹åƒ¹æ ¼:", item.price);
                    if(newPrice) item.price = newPrice;
                }
            };
            
            const toggleShopDone = (item) => {
                item.done = !item.done;
            };

            return {
                currentTab, tabs, rates, viewingDay,
                data, mapPins, mapEmbedSrc, expenses, shoppingList,
                newItemInput, newExpense,
                totalExpenseHKD, getExpenseColor, renderChart,
                shopFilter, filteredShopList,
                addItem, deleteItem, deleteShopItem, editItem, toggleShopDone, updateMap, addExpense
            };
        }
    }).mount('#app');
</script>
</body>
</html>
